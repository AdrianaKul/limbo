

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Example &mdash; limbo 0.1 documentation</title>
  

  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  

  
    <link rel="top" title="limbo 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Statistics / Writing results" href="statistics.html"/>
        <link rel="prev" title="Add External Library" href="external_libs.html"/>
<style type="text/css">
/* This CSS displays small logos at the bottom of the page, on one line */

.wy-footer-logo-container {
  margin-top: 50px;
  text-align: center;
}

.wy-footer-logo {
  display: inline-block;
  width: 60px;
}
</style>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
          

          
            <a href="http://www.resibots.eu">
          

          
            
            <img src="../_static/resibots_logo_black_200px.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="resibots-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
                  <a class="caption" href="http://www.resibots.eu">Project's website</a>
              
            

            
            
                <p class="caption"><span class="caption-text">Limbo (BO library)</span></p>
<ul class="simple">
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Limbo&#8217;s documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="compilation.html">Download and Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_example.html">Basic Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_libs.html">Add External Library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Advanced Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#problem-statement">Problem Statement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-layout">Basic Layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-the-forward-kinematic-model-as-prior">Adding the forward kinematic model as prior</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-state-based-bayesian-optimization">Using State-based bayesian optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-custom-stop-criterion">Adding custom stop criterion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-evaluation-function">Creating the evaluation function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-experiment">Creating the experiment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-gp-model">Creating the GP model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#acquisition-initialization-and-other-aliases">Acquisition, Initialization and other aliases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-the-parameter-structure">Setting the parameter structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-and-running-the-bayesian-optimizer">Creating and running the Bayesian Optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-experiment">Running the experiment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="statistics.html">Statistics / Writing results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>

            

            
            
              
                <a class="caption" href="http://github.com/resibots">github</a>
              
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">limbo</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Limbo</a> &raquo;</li>
    
      <li><a href="index.html">Tutorials</a> &raquo;</li>
    
    <li>Advanced Example</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="../_sources/tutorials/advanced_example.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-example">
<h1>Advanced Example<a class="headerlink" href="#advanced-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="problem-statement">
<h2>Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this headline">¶</a></h2>
<div class="figure">
<a class="reference external image-reference" href="../_images/arm.svg"><img alt="6-DOF planar arm" src="../_images/arm.svg" /></a>
</div>
<p>Let&#8217;s say we have a planar 6-DOF arm manipulator and we want its end-effector to reach a target position (i.e. catch an object). Now, imagine that a joint is broken (or not working properly). We want to use Bayesian Optimization to learn a compensatory behavior that will allow our arm to reach the target in spite of damage. Now, assume that once we have learned how to reach one target, we want to reach another (different) one. We will use state-based bayesian optimization to transfer knowledge between the two tasks. We will use the following:</p>
<ul class="simple">
<li>The forward kinematic model as prior knowledge (mean of GP).</li>
<li>The <code class="docutils literal"><span class="pre">Squared</span> <span class="pre">exponential</span> <span class="pre">covariance</span> <span class="pre">function</span> <span class="pre">with</span> <span class="pre">automatic</span> <span class="pre">relevance</span> <span class="pre">detection</span></code> as kernel of the GP.</li>
<li>Optimize the hyperparameters of the GP kernel using likelihood optimization.</li>
<li>Custom output statistics.</li>
<li>Use different optimizer for the acquisition optimization.</li>
<li>Initialize the GP with random samples.</li>
<li>Custom stopping criterion.</li>
</ul>
<p>Also, we assume that all of our arm&#8217;s links have <strong>length of 1cm</strong>.</p>
</div>
<div class="section" id="basic-layout">
<h2>Basic Layout<a class="headerlink" href="#basic-layout" title="Permalink to this headline">¶</a></h2>
<p>The file structure should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>limbo
|-- exp
     |-- arm_example
          +-- wscript
          +-- main.cpp
</pre></div>
</div>
<p>The basic layout of your <code class="docutils literal"><span class="pre">main.cpp</span></code> file should look like this:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;limbo/bayes_opt/boptimizer.hpp&gt;</span>
<span class="c1">// Here we have to include other needed limbo headers</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">limbo</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Params</span> <span class="p">{</span>
  <span class="c1">// Here go the parameters</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">eval_func</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">dim_in</span> <span class="o">=</span> <span class="n">sample_dimensions</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">dim_out</span> <span class="o">=</span> <span class="n">output_dimensions</span><span class="p">;</span>
  <span class="c1">// Here we define the function evaluation</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Defines, etc.</span>
  <span class="n">bayes_opt</span><span class="o">::</span><span class="n">BOptimizer</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span> <span class="n">opt</span><span class="p">;</span>
  <span class="n">opt</span><span class="p">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">eval_func</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">());</span>
  <span class="k">auto</span> <span class="n">val</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">best_observation</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">wscript</span></code> will have the following form:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">waflib.Configure</span> <span class="kn">import</span> <span class="n">conf</span>

<span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@conf</span>
<span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="n">blah</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">bld</span><span class="p">):</span>
    <span class="n">bld</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s">&#39;cxx cxxprogram&#39;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;main.cpp&#39;</span><span class="p">,</span>
        <span class="n">includes</span><span class="o">=</span><span class="s">&#39;. ../../src&#39;</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="s">&#39;arm_example&#39;</span><span class="p">,</span>
        <span class="n">uselib</span><span class="o">=</span><span class="s">&#39;BOOST EIGEN TBB LIBCMAES NLOPT&#39;</span><span class="p">,</span>
        <span class="n">use</span><span class="o">=</span><span class="s">&#39;limbo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-the-forward-kinematic-model-as-prior">
<h2>Adding the forward kinematic model as prior<a class="headerlink" href="#adding-the-forward-kinematic-model-as-prior" title="Permalink to this headline">¶</a></h2>
<p>To compute the forward kinematics of our simple planar arm we use the following code:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span> <span class="n">forward_kinematics</span><span class="p">(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">rads</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">M_PI</span><span class="p">;</span>

    <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">dh_mat</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

    <span class="n">dh_mat</span> <span class="o">&lt;&lt;</span> <span class="n">rads</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">rads</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">rads</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">rads</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">rads</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">rads</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix4d</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix4d</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dh_mat</span><span class="p">.</span><span class="n">rows</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">dh</span> <span class="o">=</span> <span class="n">dh_mat</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

        <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix4d</span> <span class="n">submat</span><span class="p">;</span>
        <span class="n">submat</span> <span class="o">&lt;&lt;</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">dh</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
            <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">dh</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">dh</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span> <span class="o">*</span> <span class="n">submat</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mat</span> <span class="o">*</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector4d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To make this forward kinematic model useful to our GP, we need to create a mean function:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">MeanFWModel</span> <span class="p">{</span>
    <span class="n">MeanFWModel</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">dim_out</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">GP</span><span class="o">&gt;</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">GP</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">forward_kinematics</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">pos</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="using-state-based-bayesian-optimization">
<h2>Using State-based bayesian optimization<a class="headerlink" href="#using-state-based-bayesian-optimization" title="Permalink to this headline">¶</a></h2>
<p>Creating an Aggregator:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">DistanceToTarget</span> <span class="p">{</span>
  <span class="k">typedef</span> <span class="kt">double</span> <span class="n">result_type</span><span class="p">;</span>
  <span class="n">DistanceToTarget</span><span class="p">(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&amp;</span> <span class="n">target</span><span class="p">)</span> <span class="o">:</span> <span class="n">_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">{}</span>

  <span class="kt">double</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">_target</span><span class="p">).</span><span class="n">norm</span><span class="p">();</span>
  <span class="p">}</span>

<span class="k">protected</span><span class="o">:</span>
  <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span> <span class="n">_target</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Here, we are using a very simple aggregator that simply computes the distance between the end-effector and the target position.</p>
</div>
<div class="section" id="adding-custom-stop-criterion">
<h2>Adding custom stop criterion<a class="headerlink" href="#adding-custom-stop-criterion" title="Permalink to this headline">¶</a></h2>
<p>When our bayesian optimizer finds a solution that the end-effector of the arm is reasonably close to the target, we want it to stop. We can easily do this by creating our own stopping criterion:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">MinTolerance</span> <span class="p">{</span>
    <span class="n">MinTolerance</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">BO</span><span class="p">,</span> <span class="k">typename</span> <span class="n">AggregatorFunction</span><span class="o">&gt;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">BO</span><span class="o">&amp;</span> <span class="n">bo</span><span class="p">,</span> <span class="k">const</span> <span class="n">AggregatorFunction</span><span class="o">&amp;</span> <span class="n">afun</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">afun</span><span class="p">(</span><span class="n">bo</span><span class="p">.</span><span class="n">best_observation</span><span class="p">(</span><span class="n">afun</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">Params</span><span class="o">::</span><span class="n">stop_mintolerance</span><span class="o">::</span><span class="n">tolerance</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-evaluation-function">
<h2>Creating the evaluation function<a class="headerlink" href="#creating-the-evaluation-function" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">eval_func</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">dim_in</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">dim_out</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">eval_func</span><span class="p">()</span> <span class="p">{}</span>

    <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="c1">// blocked joint</span>
        <span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">grip_pos</span> <span class="o">=</span> <span class="n">forward_kinematics</span><span class="p">(</span><span class="n">xx</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">grip_pos</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-experiment">
<h2>Creating the experiment<a class="headerlink" href="#creating-the-experiment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-the-gp-model">
<h3>Creating the GP model<a class="headerlink" href="#creating-the-gp-model" title="Permalink to this headline">¶</a></h3>
<p><strong>Kernel alias:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">kernel_t</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">::</span><span class="n">SquaredExpARD</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Mean alias:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">mean_t</span> <span class="o">=</span> <span class="n">MeanFWModel</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Likelihood optimization alias:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">gp_opt_t</span> <span class="o">=</span> <span class="n">model</span><span class="o">::</span><span class="n">gp</span><span class="o">::</span><span class="n">KernelLFOpt</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>GP alias:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">gp_t</span> <span class="o">=</span> <span class="n">model</span><span class="o">::</span><span class="n">GP</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="kt">kernel_t</span><span class="p">,</span> <span class="kt">mean_t</span><span class="p">,</span> <span class="kt">gp_opt_t</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="acquisition-initialization-and-other-aliases">
<h3>Acquisition, Initialization and other aliases<a class="headerlink" href="#acquisition-initialization-and-other-aliases" title="Permalink to this headline">¶</a></h3>
<p><strong>Acquisition aliases:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">acqui_t</span> <span class="o">=</span> <span class="n">acqui</span><span class="o">::</span><span class="n">UCB</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="kt">gp_t</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="kt">acqui_opt_t</span> <span class="o">=</span> <span class="n">opt</span><span class="o">::</span><span class="n">Cmaes</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Initialization alias:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">init_t</span> <span class="o">=</span> <span class="n">init</span><span class="o">::</span><span class="n">RandomSampling</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Stopping criteria alias:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">stop_t</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">stop</span><span class="o">::</span><span class="n">MaxIterations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">MinTolerance</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Statistics alias:</strong></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">using</span> <span class="kt">stat_t</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">stat</span><span class="o">::</span><span class="n">ConsoleSummary</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">Samples</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">Observations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">AggregatedObservations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">GPAcquisitions</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">BestAggregatedObservations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">GPKernelHParams</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-the-parameter-structure">
<h3>Setting the parameter structure<a class="headerlink" href="#setting-the-parameter-structure" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">struct</span> <span class="n">Params</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="nl">bayes_opt_boptimizer</span> <span class="p">:</span> <span class="k">public</span> <span class="n">defaults</span><span class="o">::</span><span class="n">bayes_opt_boptimizer</span> <span class="p">{</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="n">bayes_opt_bobase</span> <span class="p">{</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">stats_enabled</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="n">stop_maxiterations</span> <span class="p">{</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="n">stop_mintolerance</span> <span class="p">{</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="n">acqui_ucb</span> <span class="p">{</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="n">init_randomsampling</span> <span class="p">{</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="nl">kernel_squared_exp_ard</span> <span class="p">:</span> <span class="k">public</span> <span class="n">defaults</span><span class="o">::</span><span class="n">kernel_squared_exp_ard</span> <span class="p">{</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="nl">opt_rprop</span> <span class="p">:</span> <span class="k">public</span> <span class="n">defaults</span><span class="o">::</span><span class="n">opt_rprop</span> <span class="p">{</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="nl">opt_parallelrepeater</span> <span class="p">:</span> <span class="k">public</span> <span class="n">defaults</span><span class="o">::</span><span class="n">opt_parallelrepeater</span> <span class="p">{</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="n">opt_cmaes</span> <span class="p">{</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">restarts</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">max_fun_evals</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-and-running-the-bayesian-optimizer">
<h3>Creating and running the Bayesian Optimizer<a class="headerlink" href="#creating-and-running-the-bayesian-optimizer" title="Permalink to this headline">¶</a></h3>
<p>In your main function, you need to have something like the following:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// includes</span>
<span class="c1">// parameter structure</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// aliases</span>
  <span class="n">bayes_opt</span><span class="o">::</span><span class="n">BOptimizer</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="n">modelfun</span><span class="o">&lt;</span><span class="kt">gp_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">acquifun</span><span class="o">&lt;</span><span class="kt">acqui_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">acquiopt</span><span class="o">&lt;</span><span class="kt">acqui_opt_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">initfun</span><span class="o">&lt;</span><span class="kt">init_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">statsfun</span><span class="o">&lt;</span><span class="kt">stat_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stopcrit</span><span class="o">&lt;</span><span class="kt">stop_t</span><span class="o">&gt;&gt;</span> <span class="n">boptimizer</span><span class="p">;</span>
  <span class="c1">// Instantiate aggregator</span>
  <span class="n">DistanceToTarget</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span> <span class="n">aggregator</span><span class="p">({</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">});</span>
  <span class="n">boptimizer</span><span class="p">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">eval_func</span><span class="p">(),</span> <span class="n">aggregator</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;New target!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Adding new target</span>
  <span class="n">aggregator</span> <span class="o">=</span> <span class="n">DistanceToTarget</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">});</span>
  <span class="n">boptimizer</span><span class="p">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">eval_func</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">aggregator</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="c1">// rest of code</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-experiment">
<h3>Running the experiment<a class="headerlink" href="#running-the-experiment" title="Permalink to this headline">¶</a></h3>
<p>Finally, from the root of limbo, run a build command, with the additional switch <code class="docutils literal"><span class="pre">--exp</span> <span class="pre">arm_example</span></code>:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">waf</span> <span class="n">configure</span> <span class="o">--</span><span class="n">exp</span> <span class="n">arm_example</span>
<span class="p">.</span><span class="o">/</span><span class="n">waf</span> <span class="n">build</span> <span class="o">--</span><span class="n">exp</span> <span class="n">arm_example</span>
</pre></div>
</div>
<p>Then, an executable named <code class="docutils literal"><span class="pre">arm_example</span></code> should be produced under the folder <code class="docutils literal"><span class="pre">build/exp/arm_example</span></code>. When running the experiment, you should expect something like the following:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="mi">0</span> <span class="k">new</span> <span class="nl">point</span><span class="p">:</span>   <span class="mf">0.105457</span>   <span class="mf">0.984803</span>   <span class="mf">0.999724</span>   <span class="mf">0.397681</span> <span class="mf">0.00178646</span>   <span class="mf">0.472922</span> <span class="nl">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.05529</span> <span class="nl">best</span><span class="p">:</span><span class="o">-</span><span class="mf">0.50564</span>
<span class="mi">1</span> <span class="k">new</span> <span class="nl">point</span><span class="p">:</span> <span class="mf">0.0418376</span>  <span class="mf">0.211166</span>  <span class="mf">0.610741</span>   <span class="mf">0.97042</span>   <span class="mf">0.49975</span>  <span class="mf">0.932997</span> <span class="nl">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.420461</span> <span class="nl">best</span><span class="p">:</span><span class="o">-</span><span class="mf">0.420461</span>
<span class="mi">2</span> <span class="k">new</span> <span class="nl">point</span><span class="p">:</span> <span class="mf">0.0499932</span>  <span class="mf">0.809128</span>  <span class="mf">0.647616</span>  <span class="mf">0.607996</span>   <span class="mf">0.98363</span>  <span class="mf">0.263471</span> <span class="nl">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.47844</span> <span class="nl">best</span><span class="p">:</span><span class="o">-</span><span class="mf">0.420461</span>
<span class="mi">3</span> <span class="k">new</span> <span class="nl">point</span><span class="p">:</span> <span class="mf">0.926947</span> <span class="mf">0.304285</span> <span class="mf">0.962505</span> <span class="mf">0.923134</span> <span class="mf">0.340676</span> <span class="mf">0.352674</span> <span class="nl">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.77912</span> <span class="nl">best</span><span class="p">:</span><span class="o">-</span><span class="mf">0.420461</span>
<span class="mi">4</span> <span class="k">new</span> <span class="nl">point</span><span class="p">:</span>    <span class="mf">0.139309</span>  <span class="mf">0.00337038</span>   <span class="mf">0.0725873</span>     <span class="mf">0.98806</span>     <span class="mf">0.52506</span> <span class="mf">0.000522096</span> <span class="nl">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.000876567</span> <span class="nl">best</span><span class="p">:</span><span class="o">-</span><span class="mf">0.000876567</span>
<span class="n">New</span> <span class="n">target</span><span class="o">!</span>
<span class="mi">5</span> <span class="k">new</span> <span class="nl">point</span><span class="p">:</span> <span class="mf">0.0632575</span>  <span class="mf">0.981795</span>  <span class="mf">0.347888</span>  <span class="mf">0.342065</span>   <span class="mf">0.51396</span>  <span class="mf">0.785025</span> <span class="nl">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.26196</span> <span class="nl">best</span><span class="p">:</span><span class="o">-</span><span class="mf">0.50006</span>
<span class="mi">6</span> <span class="k">new</span> <span class="nl">point</span><span class="p">:</span>  <span class="mf">0.455737</span>  <span class="mf">0.978531</span>   <span class="mf">0.55947</span> <span class="mf">0.0435089</span> <span class="mf">0.0143673</span>  <span class="mf">0.999978</span> <span class="nl">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0113502</span> <span class="nl">best</span><span class="p">:</span><span class="o">-</span><span class="mf">0.0113502</span>
</pre></div>
</div>
<p>Using state-based bayesian optimization, we can transfer what we learned doing one task to learn faster new tasks.</p>
<p>The whole <code class="docutils literal"><span class="pre">main.cpp</span></code> file:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;limbo/limbo.hpp&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">limbo</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Params</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">bayes_opt_boptimizer</span> <span class="p">{</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="n">bayes_opt_bobase</span> <span class="p">{</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">stats_enabled</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="n">stop_maxiterations</span> <span class="p">{</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="n">stop_mintolerance</span> <span class="p">{</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="n">acqui_ucb</span> <span class="p">{</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="n">init_randomsampling</span> <span class="p">{</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="nl">opt_rprop</span> <span class="p">:</span> <span class="k">public</span> <span class="n">defaults</span><span class="o">::</span><span class="n">opt_rprop</span> <span class="p">{</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="nl">opt_parallelrepeater</span> <span class="p">:</span> <span class="k">public</span> <span class="n">defaults</span><span class="o">::</span><span class="n">opt_parallelrepeater</span> <span class="p">{</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="n">opt_cmaes</span> <span class="p">{</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">restarts</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">BO_PARAM</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">max_fun_evals</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span> <span class="n">forward_kinematics</span><span class="p">(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">rads</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">M_PI</span><span class="p">;</span>

    <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">dh_mat</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

    <span class="n">dh_mat</span> <span class="o">&lt;&lt;</span> <span class="n">rads</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rads</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rads</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rads</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rads</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rads</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix4d</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix4d</span><span class="o">::</span><span class="n">Identity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dh_mat</span><span class="p">.</span><span class="n">rows</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">dh</span> <span class="o">=</span> <span class="n">dh_mat</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

        <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix4d</span> <span class="n">submat</span><span class="p">;</span>
        <span class="n">submat</span> <span class="o">&lt;&lt;</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">dh</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
            <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">dh</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">cos</span><span class="p">(</span><span class="n">dh</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">dh</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span> <span class="o">*</span> <span class="n">submat</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mat</span> <span class="o">*</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector4d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">MeanFWModel</span> <span class="p">{</span>
    <span class="n">MeanFWModel</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">dim_out</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">GP</span><span class="o">&gt;</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">GP</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">forward_kinematics</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">pos</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">MinTolerance</span> <span class="p">{</span>
    <span class="n">MinTolerance</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">BO</span><span class="p">,</span> <span class="k">typename</span> <span class="n">AggregatorFunction</span><span class="o">&gt;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">BO</span><span class="o">&amp;</span> <span class="n">bo</span><span class="p">,</span> <span class="k">const</span> <span class="n">AggregatorFunction</span><span class="o">&amp;</span> <span class="n">afun</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">afun</span><span class="p">(</span><span class="n">bo</span><span class="p">.</span><span class="n">best_observation</span><span class="p">(</span><span class="n">afun</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">Params</span><span class="o">::</span><span class="n">stop_mintolerance</span><span class="o">::</span><span class="n">tolerance</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">DistanceToTarget</span> <span class="p">{</span>
    <span class="k">typedef</span> <span class="kt">double</span> <span class="n">result_type</span><span class="p">;</span>
    <span class="n">DistanceToTarget</span><span class="p">(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&amp;</span> <span class="n">target</span><span class="p">)</span> <span class="o">:</span> <span class="n">_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">{}</span>

    <span class="kt">double</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">_target</span><span class="p">).</span><span class="n">norm</span><span class="p">();</span>
    <span class="p">}</span>

<span class="k">protected</span><span class="o">:</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span> <span class="n">_target</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Params</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">eval_func</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">dim_in</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">dim_out</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">eval_func</span><span class="p">()</span> <span class="p">{}</span>

    <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="c1">// blocked joint</span>
        <span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">grip_pos</span> <span class="o">=</span> <span class="n">forward_kinematics</span><span class="p">(</span><span class="n">xx</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">grip_pos</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="kt">kernel_t</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">::</span><span class="n">SquaredExpARD</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">using</span> <span class="kt">mean_t</span> <span class="o">=</span> <span class="n">MeanFWModel</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">using</span> <span class="kt">gp_opt_t</span> <span class="o">=</span> <span class="n">model</span><span class="o">::</span><span class="n">gp</span><span class="o">::</span><span class="n">KernelLFOpt</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">using</span> <span class="kt">gp_t</span> <span class="o">=</span> <span class="n">model</span><span class="o">::</span><span class="n">GP</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="kt">kernel_t</span><span class="p">,</span> <span class="kt">mean_t</span><span class="p">,</span> <span class="kt">gp_opt_t</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">using</span> <span class="kt">acqui_t</span> <span class="o">=</span> <span class="n">acqui</span><span class="o">::</span><span class="n">UCB</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="kt">gp_t</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="kt">acqui_opt_t</span> <span class="o">=</span> <span class="n">opt</span><span class="o">::</span><span class="n">Cmaes</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">using</span> <span class="kt">init_t</span> <span class="o">=</span> <span class="n">init</span><span class="o">::</span><span class="n">RandomSampling</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">using</span> <span class="kt">stop_t</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">stop</span><span class="o">::</span><span class="n">MaxIterations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">MinTolerance</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;&gt;</span><span class="p">;</span>

    <span class="k">using</span> <span class="kt">stat_t</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">stat</span><span class="o">::</span><span class="n">ConsoleSummary</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">Samples</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">Observations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">AggregatedObservations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">GPAcquisitions</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">BestAggregatedObservations</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stat</span><span class="o">::</span><span class="n">GPKernelHParams</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;&gt;</span><span class="p">;</span>

    <span class="n">bayes_opt</span><span class="o">::</span><span class="n">BOptimizer</span><span class="o">&lt;</span><span class="n">Params</span><span class="p">,</span> <span class="n">modelfun</span><span class="o">&lt;</span><span class="kt">gp_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">acquifun</span><span class="o">&lt;</span><span class="kt">acqui_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">acquiopt</span><span class="o">&lt;</span><span class="kt">acqui_opt_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">initfun</span><span class="o">&lt;</span><span class="kt">init_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">statsfun</span><span class="o">&lt;</span><span class="kt">stat_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">stopcrit</span><span class="o">&lt;</span><span class="kt">stop_t</span><span class="o">&gt;&gt;</span> <span class="n">boptimizer</span><span class="p">;</span>
    <span class="c1">// Instantiate aggregator</span>
    <span class="n">DistanceToTarget</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span> <span class="n">aggregator</span><span class="p">({</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">});</span>
    <span class="n">boptimizer</span><span class="p">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">eval_func</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">aggregator</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;New target!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">aggregator</span> <span class="o">=</span> <span class="n">DistanceToTarget</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">});</span>
    <span class="n">boptimizer</span><span class="p">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">eval_func</span><span class="o">&lt;</span><span class="n">Params</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">aggregator</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="statistics.html" class="btn btn-neutral float-right" title="Statistics / Writing results" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="external_libs.html" class="btn btn-neutral" title="Add External Library" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="wy-footer">
    <div role="contentinfo">
      <p>
          &copy; Copyright 2014-2015, UPMC/Inria.

      
      
        <br/>
        <a href="mailto:jean-baptiste.mouret@inria.fr"> Contact us </a>
      
      </p>
    </div>
    <div class="wy-footer-aside">
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> modified for <a href="http://resibots.eu">Resibots</a>.
    </div>
    <div style="clear: both;"></div>
  </div>
<div class="wy-footer-logo-container">
  <div class="wy-footer-logo"><img src="../_static/logos/logo_eu.png"/></div>
  <div class="wy-footer-logo"><img src="../_static/logos/logo_erc_nonofficial.svg"/></div>
  <div class="wy-footer-logo"><img src="../_static/logos/logo_loria.jpg"/></div>
  <div class="wy-footer-logo"><img src="../_static/logos/logo-inria.svg"/></div>
  <div class="wy-footer-logo"><img src="../_static/logos/logo_cnrs.png"/></div>
  <div class="wy-footer-logo"><img src="../_static/logos/logo_universite_lorraine.jpg"/></div>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxResibotsTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>